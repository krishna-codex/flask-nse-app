FROM python:3.11-slim-bullseye

# System dependencies
RUN apt-get update && apt-get install -y \
    chromium chromium-driver \
    libglib2.0-0 libnss3 libgconf-2-4 libxss1 libappindicator3-1 \
    libasound2 libxshmfence-dev wget curl unzip gnupg \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# Environment variables for Chrome and unbuffered output
ENV CHROME_BIN=/usr/bin/chromium
ENV CHROMEDRIVER_PATH=/usr/bin/chromedriver
ENV PYTHONUNBUFFERED=1

# Working directory
WORKDIR /app

# Copy project files
COPY . .

# Install dependencies globally (no virtualenv to avoid buffering issues)
RUN pip install --no-cache-dir --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt

# Run Python script with unbuffered output
CMD ["python", "-u", "app.py"]
